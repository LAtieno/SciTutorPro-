<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SciTutor Pro</title>
<style>
body{font-family:Arial;height:100vh;display:flex;justify-content:center;align-items:center;background:#f5f5f5;margin:0;}
#chat-container{width:380px;height:620px;background:#fff;border-radius:12px;box-shadow:0 0 20px rgba(0,0,0,0.1);display:flex;flex-direction:column;overflow:hidden;}
#messages{flex:1;padding:15px;overflow-y:auto;}
.msg{margin-bottom:12px;line-height:1.4;}
.user{text-align:right;color:#0057ff;}
.bot{text-align:left;color:#111;}
#input-area{padding:10px;border-top:1px solid #ddd;display:flex;gap:10px;background:#fafafa;}
#input-area input{flex:1;padding:10px;border-radius:8px;border:1px solid #ccc;}
#input-area button{padding:10px 15px;background:#0057ff;color:white;border:none;border-radius:8px;cursor:pointer;}
#upgrade{margin:5px;text-align:center;}
#upgrade button{background:#ff5722;color:white;border:none;padding:5px 10px;border-radius:6px;cursor:pointer;}
</style>
</head>
<body>
<div id="chat-container">
  <div id="messages"></div>
  <div id="upgrade"><button onclick="goPremium()">Upgrade to Premium</button></div>
  <div id="input-area">
    <input id="userInput" type="text" placeholder="Ask a science question...">
    <button id="sendBtn">Send</button>
  </div>
</div>
<script>
const sendBtn=document.getElementById("sendBtn");
const input=document.getElementById("userInput");
const messagesDiv=document.getElementById("messages");
let freeCount=parseInt(localStorage.getItem("freeCount")||"0");
const MAX_FREE=5;
sendBtn.onclick=sendMessage;
input.addEventListener("keydown",e=>{if(e.key==="Enter") sendMessage();});
function addMessage(text,sender){const div=document.createElement("div");div.className=sender+" msg";div.textContent=text;messagesDiv.appendChild(div);messagesDiv.scrollTop=messagesDiv.scrollHeight;}
async function sendMessage(){const text=input.value.trim();if(!text)return;if(freeCount>=MAX_FREE){alert("Free daily limit reached. Upgrade.");return;}addMessage(text,"user");input.value="";addMessage("â€¦thinking","bot");const tNode=messagesDiv.lastChild;try{const res=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:text})});const data=await res.json();tNode.remove();addMessage(data.answer,"bot");freeCount++;localStorage.setItem("freeCount",freeCount);}catch(err){tNode.remove();addMessage("Server error","bot");}}
async function goPremium(){const res=await fetch("/api/checkout",{method:"POST"});const data=await res.json();window.location.href=data.url;}
</script>
</body>
</html>
